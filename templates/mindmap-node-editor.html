<!-- Mindmap Node Editor Modal -->
<div x-show="showMindmapNodeEditor"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     @click="closeMindmapNodeEditor()"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">

    <!-- Modal Window -->
    <div @click.stop
         x-show="showMindmapNodeEditor"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col overflow-hidden">

        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-3">
                <i data-lucide="edit-3" class="w-5 h-5 text-cyan-600 dark:text-cyan-400"></i>
                <h2 class="text-xl font-bold text-slate-800 dark:text-slate-200" x-text="mindmapNodeEditorMode === 'create' ? 'Create Node' : 'Edit Node'"></h2>
            </div>
            <button @click="closeMindmapNodeEditor()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-6 space-y-4">

            <!-- Formatting Toolbar - Simplified -->
            <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg p-2">
                <div class="flex items-center gap-1 flex-wrap">
                    <!-- Text Style -->
                    <button @click.prevent="formatMindmapText('bold')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Bold (Ctrl+B)">
                        <i data-lucide="bold" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button @click.prevent="formatMindmapText('italic')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Italic (Ctrl+I)">
                        <i data-lucide="italic" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button @click.prevent="formatMindmapText('underline')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Underline (Ctrl+U)">
                        <i data-lucide="underline" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>

                    <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                    <!-- Lists -->
                    <button @click.prevent="formatMindmapText('insertUnorderedList')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Bullet List">
                        <i data-lucide="list" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button @click.prevent="formatMindmapText('insertOrderedList')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Numbered List">
                        <i data-lucide="list-ordered" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>

                    <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                    <!-- Indent -->
                    <button @click.prevent="formatMindmapText('indent')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Indent">
                        <i data-lucide="indent" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button @click.prevent="formatMindmapText('outdent')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Outdent">
                        <i data-lucide="outdent" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                    </button>
                </div>
            </div>

            <!-- Content Editor -->
            <div>
                <div
                    id="mindmapNodeContentEditor"
                    contenteditable="true"
                    @input="mindmapNodeEditorContent = $event.target.innerHTML"
                    class="w-full min-h-[300px] max-h-[400px] overflow-y-auto p-4 text-slate-800 dark:text-slate-200 bg-white dark:bg-gray-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:border-cyan-500 dark:focus:border-cyan-400 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 transition-colors"
                    data-placeholder="Enter your content here... Use the toolbar above to format text."
                    style="white-space: pre-wrap;"
                ></div>
                <style>
                    #mindmapNodeContentEditor:empty:before {
                        content: attr(data-placeholder);
                        color: #9ca3af;
                        pointer-events: none;
                    }

                    #mindmapNodeContentEditor ul,
                    #mindmapNodeContentEditor ol {
                        margin: 0.5em 0;
                        padding-left: 2em;
                    }

                    #mindmapNodeContentEditor ul {
                        list-style-type: disc;
                    }

                    #mindmapNodeContentEditor ol {
                        list-style-type: decimal;
                    }

                    #mindmapNodeContentEditor li {
                        margin: 0.25em 0;
                    }

                    #mindmapNodeContentEditor p {
                        margin: 0.5em 0;
                    }

                    /* Dark mode overrides */
                    .dark #mindmapNodeContentEditor ul,
                    .dark #mindmapNodeContentEditor ol {
                        color: #e5e7eb;
                    }
                </style>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="flex items-center justify-end space-x-3 p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
            <button @click="closeMindmapNodeEditor()" class="px-4 py-2 text-slate-700 dark:text-slate-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors font-medium">
                Cancel
            </button>
            <button @click="saveMindmapNode()" class="px-6 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white rounded-lg transition-all font-medium shadow-md hover:shadow-lg">
                Save Node
            </button>
        </div>
    </div>
</div>

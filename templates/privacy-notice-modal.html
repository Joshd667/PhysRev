<!-- First-Time Privacy Notice Modal (BLOCKING - Must Acknowledge) -->
<div x-show="showPrivacyNoticeModal"
     class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] flex items-center justify-center p-4"
     style="display: none;"
     x-data="{
         documentsRead: { privacy: false, terms: false, retention: false, accessibility: false },
         isTeamsLogin: false,
         init() {
             // Watch for modal visibility changes and update Teams mode
             this.$watch('showPrivacyNoticeModal', value => {
                 if (value) {
                     this.isTeamsLogin = window.isTeamsPrivacyMode || false;
                     console.log('Privacy modal opened, Teams mode:', this.isTeamsLogin);
                 }
             });
         }
     }"
     @click.stop>

    <!-- Modal Window -->
    <div @click.stop
         x-show="showPrivacyNoticeModal"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">

        <!-- Header -->
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
            <div class="flex items-start space-x-4">
                <div class="w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg">
                    <i data-lucide="atom" class="w-7 h-7 text-white"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200 mb-1">Welcome to Physics Knowledge Audit Tool</h2>
                    <p class="text-sm text-slate-600 dark:text-slate-400">A-Level Physics revision and progress tracking made simple</p>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-6 minimal-scrollbar space-y-6">

            <!-- Introduction -->
            <div>
                <p class="text-slate-700 dark:text-slate-300 leading-relaxed mb-3">
                    Welcome! This tool is designed to support your A-Level physics studies by helping you track your confidence across all specification topics, create comprehensive study materials including notes, flashcards, and interactive mindmaps, and monitor your learning progress with detailed analytics dashboards.
                </p>
                <p class="text-slate-700 dark:text-slate-300 leading-relaxed">
                    Whether you're preparing for exams, identifying knowledge gaps, or organizing your revision, this app provides everything you need in one place. You can self-assess your understanding, access curated revision resources, and build a complete study library that grows with you throughout your course.
                </p>
            </div>

            <!-- How Your Data is Processed -->
            <div class="space-y-3">
                <h3 class="font-bold text-lg text-slate-800 dark:text-slate-200">How Your Data is Processed</h3>

                <p class="text-slate-700 dark:text-slate-300 leading-relaxed text-sm mb-3">
                    This is a privacy-first educational tool. Please review our privacy practices and terms of use below. We need you to understand how your educational data is processed and what your rights are under UK GDPR.
                </p>

                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 mt-0.5">
                        <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <strong class="text-slate-800 dark:text-slate-200" x-text="isTeamsLogin ? 'Stored with Us & Backed Up' : 'Stored Locally on Your Device'"></strong>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">
                            <span x-show="!isTeamsLogin">All your confidence ratings, notes, flashcards, and study materials are stored in your browser's IndexedDB. Your data never leaves your device.</span>
                            <span x-show="isTeamsLogin" class="text-orange-700 dark:text-orange-300 font-medium">Your data is stored with us and backed up to your Teams user area. Confidence ratings will be accessible to your teacher for progress monitoring. Study materials are private unless you choose to share them.</span>
                        </p>
                    </div>
                </div>

                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 mt-0.5">
                        <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <strong class="text-slate-800 dark:text-slate-200">No Cookies or Tracking</strong>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">We don't use cookies, Google Analytics, or any tracking technologies. Your learning progress is private.</p>
                    </div>
                </div>

                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 mt-0.5">
                        <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <strong class="text-slate-800 dark:text-slate-200">Full Control Over Your Data</strong>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">You can export your data (JSON/CSV), delete individual items, or clear all data at any time via Settings → Data Management.</p>
                    </div>
                </div>

                <!-- Teams Online Storage Summary (only shown for Teams mode) -->
                <div x-show="isTeamsLogin" class="flex items-start space-x-3">
                    <div class="flex-shrink-0 mt-0.5">
                        <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"/>
                        </svg>
                    </div>
                    <div>
                        <strong class="text-slate-800 dark:text-slate-200">Online Storage with Backup</strong>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">Your data is stored with us and automatically backed up to your Microsoft Teams user area. Your teacher can view your confidence ratings for progress monitoring.</p>
                    </div>
                </div>

                <!-- Teams-specific data sharing notice -->
                <div x-show="isTeamsLogin" class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800 mt-3">
                    <div class="flex items-start space-x-3">
                        <i data-lucide="users" class="w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5 flex-shrink-0"></i>
                        <div>
                            <p class="text-sm font-semibold text-orange-800 dark:text-orange-200 mb-1">Microsoft Teams Data Sharing</p>
                            <ul class="text-xs text-orange-700 dark:text-orange-300 space-y-1 list-disc list-inside">
                                <li><strong>Confidence Ratings:</strong> Backed up to Teams, visible to assigned teachers</li>
                                <li><strong>Analytics History:</strong> Backed up to Teams, accessible to teachers for progress monitoring</li>
                                <li><strong>Study Materials:</strong> Backed up to your Teams account, private by default</li>
                                <li><strong>Data Storage:</strong> Microsoft servers (subject to Microsoft's data protection policies)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legal Documents Section -->
            <div class="border-t border-gray-200 dark:border-gray-600 pt-5">
                <p class="text-sm text-slate-700 dark:text-slate-300 mb-3">
                    The following documents provide detailed information about your privacy rights and how we handle your data. We encourage you to review them:
                </p>

                <div class="space-y-2">
                    <!-- Privacy Notice -->
                    <a href="./legal/privacy-notice.html"
                       target="_blank"
                       @click="documentsRead.privacy = true"
                       class="w-full flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-700 hover:bg-blue-50 dark:hover:bg-gray-600 rounded-lg transition-colors border border-gray-200 dark:border-gray-600 group">
                        <div class="flex items-center space-x-3 flex-1">
                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="shield" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div class="text-left flex-1">
                                <div class="font-semibold text-sm text-slate-800 dark:text-slate-200">Privacy Notice</div>
                                <div class="text-xs text-slate-600 dark:text-slate-400">UK GDPR compliance and data rights</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div x-show="documentsRead.privacy" class="flex items-center space-x-1 text-green-600 dark:text-green-400">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="text-xs font-medium">Read</span>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-blue-600"></i>
                            </div>
                        </div>
                    </a>

                    <!-- Terms of Service -->
                    <a href="./legal/terms-of-service.html"
                       target="_blank"
                       @click="documentsRead.terms = true"
                       class="w-full flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-700 hover:bg-green-50 dark:hover:bg-gray-600 rounded-lg transition-colors border border-gray-200 dark:border-gray-600 group">
                        <div class="flex items-center space-x-3 flex-1">
                            <div class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="file-text" class="w-4 h-4 text-green-600 dark:text-green-400"></i>
                            </div>
                            <div class="text-left flex-1">
                                <div class="font-semibold text-sm text-slate-800 dark:text-slate-200">Terms of Service</div>
                                <div class="text-xs text-slate-600 dark:text-slate-400">Usage rules and guidelines</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div x-show="documentsRead.terms" class="flex items-center space-x-1 text-green-600 dark:text-green-400">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="text-xs font-medium">Read</span>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-green-600"></i>
                            </div>
                        </div>
                    </a>

                    <!-- Data Retention Policy -->
                    <a href="./legal/data-retention-policy.html"
                       target="_blank"
                       @click="documentsRead.retention = true"
                       class="w-full flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-700 hover:bg-purple-50 dark:hover:bg-gray-600 rounded-lg transition-colors border border-gray-200 dark:border-gray-600 group">
                        <div class="flex items-center space-x-3 flex-1">
                            <div class="w-8 h-8 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="clock" class="w-4 h-4 text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div class="text-left flex-1">
                                <div class="font-semibold text-sm text-slate-800 dark:text-slate-200">Data Retention Policy</div>
                                <div class="text-xs text-slate-600 dark:text-slate-400">How long we keep your data</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div x-show="documentsRead.retention" class="flex items-center space-x-1 text-green-600 dark:text-green-400">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="text-xs font-medium">Read</span>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-purple-600"></i>
                            </div>
                        </div>
                    </a>

                    <!-- Accessibility Statement -->
                    <a href="./legal/accessibility-statement.html"
                       target="_blank"
                       @click="documentsRead.accessibility = true"
                       class="w-full flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-700 hover:bg-orange-50 dark:hover:bg-gray-600 rounded-lg transition-colors border border-gray-200 dark:border-gray-600 group">
                        <div class="flex items-center space-x-3 flex-1">
                            <div class="w-8 h-8 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="accessibility" class="w-4 h-4 text-orange-600 dark:text-orange-400"></i>
                            </div>
                            <div class="text-left flex-1">
                                <div class="font-semibold text-sm text-slate-800 dark:text-slate-200">Accessibility Statement</div>
                                <div class="text-xs text-slate-600 dark:text-slate-400">WCAG 2.1 AA compliance</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div x-show="documentsRead.accessibility" class="flex items-center space-x-1 text-green-600 dark:text-green-400">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="text-xs font-medium">Read</span>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-orange-600"></i>
                            </div>
                        </div>
                    </a>
                </div>

                <p class="text-xs text-slate-500 dark:text-slate-400 mt-3 italic text-center">
                    Documents open in a new tab. You can access these anytime via Settings → Privacy & Legal
                </p>
            </div>

        </div>

        <!-- Footer -->
        <div class="border-t border-gray-200 dark:border-gray-700 p-5 bg-gray-50 dark:bg-gray-900/50">
            <div class="flex items-center justify-between">
                <p class="text-xs text-slate-600 dark:text-slate-400">
                    By continuing, you acknowledge this information notice.
                </p>
                <button
                    @click="isTeamsLogin ? continueToTeamsLogin() : closePrivacyNotice()"
                    class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg transition-all font-semibold shadow-lg flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>I Understand</span>
                </button>
            </div>
        </div>

    </div>
</div>

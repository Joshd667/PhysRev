<!-- Note Editor Modal -->
<div x-show="showNoteEditor"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     @click="closeNoteEditor()"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">

    <!-- Modal Window -->
    <div @click.stop
         x-show="showNoteEditor"
         x-data="{ editorExpanded: false }"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden">

        <!-- Header -->
        <div class="border-b border-gray-200 dark:border-gray-700">
            <!-- Top row: Title and buttons -->
            <div class="flex items-center justify-between px-6 pt-6 pb-3">
                <div class="flex items-center space-x-3">
                    <i data-lucide="edit-3" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200" x-text="noteEditorMode === 'create' ? 'Create New Note' : 'Edit Note'"></h2>
                </div>
                <div class="flex items-center space-x-2">
                    <!-- Undo/Redo Buttons -->
                    <button @click.prevent="formatText('undo')" type="button" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors" title="Undo (Ctrl+Z)">
                        <i data-lucide="undo" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                    </button>
                    <button @click.prevent="formatText('redo')" type="button" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors" title="Redo (Ctrl+Y)">
                        <i data-lucide="redo" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                    </button>
                    <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>
                    <button @click="closeNoteEditor()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                    </button>
                </div>
            </div>

            <!-- Note Title Input -->
            <div class="px-6 pb-6">
                <input
                    x-model="noteEditorTitle"
                    type="text"
                    placeholder="Enter note title..."
                    class="w-full px-4 py-2 text-lg font-semibold text-slate-800 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500 bg-white dark:bg-gray-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none transition-colors"
                />
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-6 space-y-4 minimal-scrollbar">

            <!-- Rich Text Editor Toolbar -->
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Content</label>

                <!-- Formatting Toolbar - Compact 2-row Layout -->
                <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-t-lg">

                    <!-- Row 1: Text Style & Formatting -->
                    <div class="flex items-center gap-1 p-2 border-b border-gray-200 dark:border-gray-700 flex-wrap">
                        <!-- Format Block -->
                        <select @change="formatBlock($event.target.value)" class="px-3 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                            <option value="">Paragraph</option>
                            <option value="h1">Heading 1</option>
                            <option value="h2">Heading 2</option>
                            <option value="h3">Heading 3</option>
                            <option value="h4">Heading 4</option>
                            <option value="p">Normal</option>
                        </select>

                        <!-- Font Size -->
                        <select @change="changeFontSize($event.target.value)" class="px-3 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                            <option value="">Size</option>
                            <option value="1">8pt</option>
                            <option value="2">10pt</option>
                            <option value="3">12pt</option>
                            <option value="4">14pt</option>
                            <option value="5">18pt</option>
                            <option value="6">24pt</option>
                            <option value="7">36pt</option>
                        </select>

                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                        <!-- Text Style -->
                        <button @click.prevent="formatText('bold')" type="button" :class="isFormatActive('bold') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Bold (Ctrl+B)">
                            <i data-lucide="bold" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('italic')" type="button" :class="isFormatActive('italic') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Italic (Ctrl+I)">
                            <i data-lucide="italic" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('underline')" type="button" :class="isFormatActive('underline') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Underline (Ctrl+U)">
                            <i data-lucide="underline" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('strikeThrough')" type="button" :class="isFormatActive('strikeThrough') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Strikethrough">
                            <i data-lucide="strikethrough" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                        <!-- Text Color -->
                        <div class="relative" x-data="{ showColorPicker: false }">
                            <button @click.prevent="showColorPicker = !showColorPicker" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors flex items-center gap-1" title="Text Color">
                                <i data-lucide="palette" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                                <i data-lucide="chevron-down" class="w-3 h-3 text-gray-500"></i>
                            </button>
                            <div x-show="showColorPicker" @click.away="showColorPicker = false" x-transition class="absolute top-full left-0 mt-1 p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-lg z-50 grid grid-cols-4 gap-2 w-36">
                                <button @click.prevent="changeTextColor('#000000'); showColorPicker = false" type="button" class="w-7 h-7 bg-black border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Black"></button>
                                <button @click.prevent="changeTextColor('#ef4444'); showColorPicker = false" type="button" class="w-7 h-7 bg-red-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Red"></button>
                                <button @click.prevent="changeTextColor('#f59e0b'); showColorPicker = false" type="button" class="w-7 h-7 bg-orange-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Orange"></button>
                                <button @click.prevent="changeTextColor('#eab308'); showColorPicker = false" type="button" class="w-7 h-7 bg-yellow-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Yellow"></button>
                                <button @click.prevent="changeTextColor('#22c55e'); showColorPicker = false" type="button" class="w-7 h-7 bg-green-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Green"></button>
                                <button @click.prevent="changeTextColor('#3b82f6'); showColorPicker = false" type="button" class="w-7 h-7 bg-blue-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Blue"></button>
                                <button @click.prevent="changeTextColor('#8b5cf6'); showColorPicker = false" type="button" class="w-7 h-7 bg-purple-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Purple"></button>
                                <button @click.prevent="changeTextColor('#ec4899'); showColorPicker = false" type="button" class="w-7 h-7 bg-pink-500 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Pink"></button>
                            </div>
                        </div>

                        <!-- Highlight Color -->
                        <div class="relative" x-data="{ showHighlightPicker: false }">
                            <button @click.prevent="showHighlightPicker = !showHighlightPicker" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors flex items-center gap-1" title="Highlight Color">
                                <i data-lucide="highlighter" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                                <i data-lucide="chevron-down" class="w-3 h-3 text-gray-500"></i>
                            </button>
                            <div x-show="showHighlightPicker" @click.away="showHighlightPicker = false" x-transition class="absolute top-full left-0 mt-1 p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-lg z-50 grid grid-cols-3 gap-2 w-28">
                                <button @click.prevent="changeHighlightColor('transparent'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-white border border-gray-300 rounded hover:ring-2 hover:ring-blue-500 relative" title="No Highlight">
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="w-5 h-0.5 bg-red-500 rotate-45"></div>
                                    </div>
                                </button>
                                <button @click.prevent="changeHighlightColor('#fef08a'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-yellow-200 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Yellow"></button>
                                <button @click.prevent="changeHighlightColor('#bbf7d0'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-green-200 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Green"></button>
                                <button @click.prevent="changeHighlightColor('#bfdbfe'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-blue-200 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Blue"></button>
                                <button @click.prevent="changeHighlightColor('#fecaca'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-red-200 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Red"></button>
                                <button @click.prevent="changeHighlightColor('#e9d5ff'); showHighlightPicker = false" type="button" class="w-7 h-7 bg-purple-200 border border-gray-300 rounded hover:ring-2 hover:ring-blue-500" title="Purple"></button>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2: Alignment, Lists, Indentation & Insert Tools -->
                    <div class="flex items-center gap-1 p-2 flex-wrap">
                        <!-- Alignment -->
                        <button @click.prevent="formatText('justifyLeft')" type="button" :class="isFormatActive('justifyLeft') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Align Left">
                            <i data-lucide="align-left" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('justifyCenter')" type="button" :class="isFormatActive('justifyCenter') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Align Center">
                            <i data-lucide="align-center" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('justifyRight')" type="button" :class="isFormatActive('justifyRight') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Align Right">
                            <i data-lucide="align-right" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('justifyFull')" type="button" :class="isFormatActive('justifyFull') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Justify">
                            <i data-lucide="align-justify" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                        <!-- Lists -->
                        <button @click.prevent="formatText('insertUnorderedList')" type="button" :class="isFormatActive('insertUnorderedList') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Bullet List">
                            <i data-lucide="list" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('insertOrderedList')" type="button" :class="isFormatActive('insertOrderedList') ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500' : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'" class="p-2 border rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Numbered List">
                            <i data-lucide="list-ordered" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                        <!-- Indentation -->
                        <button @click.prevent="formatText('outdent')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Decrease Indent">
                            <i data-lucide="indent-decrease" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('indent')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Increase Indent">
                            <i data-lucide="indent-increase" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"></div>

                        <!-- Insert Tools -->
                        <button @click.prevent="insertLink()" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Insert Link">
                            <i data-lucide="link" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="formatText('insertHorizontalRule')" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Insert Horizontal Line">
                            <i data-lucide="minus" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="insertBlockquote()" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Insert Quote">
                            <i data-lucide="quote" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>
                        <button @click.prevent="insertCode()" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Insert Code">
                            <i data-lucide="code" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <!-- NEW: Equation Button -->
                        <button @click.prevent="openEquationEditor()" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" title="Add Equation">
                            <i data-lucide="function-square" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                        </button>

                        <div class="flex-1"></div>

                        <!-- Expand/Collapse Button -->
                        <button @click="editorExpanded = !editorExpanded" type="button" class="p-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors flex items-center gap-1" title="Expand/Collapse Editor">
                            <i :data-lucide="editorExpanded ? 'minimize-2' : 'maximize-2'" class="w-4 h-4 text-gray-700 dark:text-gray-300"></i>
                            <span class="text-xs font-medium text-gray-700 dark:text-gray-300" x-text="editorExpanded ? 'Collapse' : 'Expand'"></span>
                        </button>
                    </div>
                </div>

                <!-- Content Editor (contentEditable) -->
                <div
                    id="noteContentEditor"
                    contenteditable="true"
                    @mouseup="editorSelectionUpdate++"
                    @keyup="editorSelectionUpdate++"
                    @click="editorSelectionUpdate++"
                    @dblclick="handleEditorDoubleClick($event)"
                    :class="editorExpanded ? 'min-h-[400px] max-h-[500px]' : 'min-h-[200px] max-h-[250px]'"
                    class="w-full overflow-y-auto p-6 text-base leading-relaxed text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border border-t-0 border-gray-300 dark:border-gray-600 rounded-b-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 transition-all duration-200"
                    style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;"
                ></div>

                <style>
                    #noteContentEditor:empty:before {
                        content: "Start typing your notes here...";
                        color: #9ca3af;
                        pointer-events: none;
                    }

                    #noteContentEditor h1 {
                        font-size: 2em;
                        font-weight: bold;
                        margin: 0.67em 0;
                        line-height: 1.2;
                    }

                    #noteContentEditor h2 {
                        font-size: 1.5em;
                        font-weight: bold;
                        margin: 0.75em 0;
                        line-height: 1.3;
                    }

                    #noteContentEditor h3 {
                        font-size: 1.17em;
                        font-weight: bold;
                        margin: 0.83em 0;
                        line-height: 1.4;
                    }

                    #noteContentEditor h4 {
                        font-size: 1em;
                        font-weight: bold;
                        margin: 1em 0;
                        line-height: 1.4;
                    }

                    #noteContentEditor p {
                        margin: 0.5em 0;
                    }

                    #noteContentEditor ul, #noteContentEditor ol {
                        margin: 0.5em 0;
                        padding-left: 2em;
                    }

                    #noteContentEditor ul {
                        list-style-type: disc;
                    }

                    #noteContentEditor ol {
                        list-style-type: decimal;
                    }

                    #noteContentEditor li {
                        margin: 0.25em 0;
                    }

                    #noteContentEditor a {
                        color: #3b82f6;
                        text-decoration: underline;
                    }

                    #noteContentEditor a:hover {
                        color: #2563eb;
                    }

                    #noteContentEditor hr {
                        border: none;
                        border-top: 2px solid #e5e7eb;
                        margin: 1em 0;
                    }

                    /* Dark mode overrides */
                    .dark #noteContentEditor h1,
                    .dark #noteContentEditor h2,
                    .dark #noteContentEditor h3,
                    .dark #noteContentEditor h4 {
                        color: #f3f4f6;
                    }

                    .dark #noteContentEditor a {
                        color: #60a5fa;
                    }

                    .dark #noteContentEditor a:hover {
                        color: #93c5fd;
                    }

                    .dark #noteContentEditor hr {
                        border-top-color: #4b5563;
                    }
                </style>
            </div>

            <!-- Topic Tags Section -->
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 flex items-center space-x-2">
                    <i data-lucide="tag" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                    <span>Topic Tags</span>
                </label>

                <!-- Current Tags -->
                <div class="flex flex-wrap gap-2 mb-3">
                    <template x-if="noteEditorTags.length === 0">
                        <span class="text-sm text-slate-500 dark:text-slate-400 italic">No tags added yet</span>
                    </template>
                    <template x-for="tagId in noteEditorTags" :key="tagId">
                        <div class="flex items-center space-x-1 px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg text-sm border border-blue-300 dark:border-blue-700">
                            <span class="font-mono font-bold text-xs" x-text="tagId"></span>
                            <span class="text-xs" x-text="topicLookup[tagId] ? topicLookup[tagId].topicTitle : ''"></span>
                            <button
                                @click="removeTagDirect('note', tagId)"
                                class="ml-1 hover:bg-blue-200 dark:hover:bg-blue-800 rounded p-0.5 transition-colors">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </template>
                </div>

                <!-- Add Tags Button -->
                <button
                    @click="openTagSelector('note')"
                    type="button"
                    class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-white dark:bg-gray-700 border border-blue-300 dark:border-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg transition-colors text-sm font-medium">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    <span>Add Topic Tags</span>
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50">
            <button @click="closeNoteEditor()" class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg transition-colors font-medium">
                Cancel
            </button>
            <button @click="saveNote()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium flex items-center space-x-2">
                <i data-lucide="save" class="w-4 h-4"></i>
                <span x-text="noteEditorMode === 'create' ? 'Create Note' : 'Save Changes'"></span>
            </button>
        </div>
    </div>
</div>

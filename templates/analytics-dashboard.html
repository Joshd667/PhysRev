                        <div x-show="!searchVisible && showingAnalytics && !showingRevision" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-95 -translate-y-4" x-transition:enter-end="opacity-100 transform scale-100 translate-y-0">
                            <div class="mb-4">
                                <button @click="goBackFromAnalytics()" class="flex items-center space-x-2 px-4 py-2 bg-white/60 dark:bg-gray-700/60 hover:bg-white/80 dark:hover:bg-gray-600/80 backdrop-blur-sm rounded-lg transition-colors text-gray-700 dark:text-gray-300">
                                    <svg class="w-4 h-4 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <span class="text-sm font-medium">Back to Specification</span>
                                </button>
                            </div>

                            <!-- Overview Metrics -->
                            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center">
                                        <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                            <i data-lucide="target" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Progress</p>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.totalProgress + '%'"></p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="`${analyticsData?.overview.assessedTopics || 0}/${analyticsData?.overview.totalTopics || 0} topics`"></p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center">
                                        <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
                                            <i data-lucide="trending-up" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Avg Confidence</p>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.avgConfidence + '/5'"></p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Across all topics</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center">
                                        <div class="p-2 bg-red-100 dark:bg-red-900 rounded-lg">
                                            <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600 dark:text-red-400"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Need Attention</p>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.lowConfidenceCount || 0"></p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Low confidence topics</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center">
                                        <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
                                            <i data-lucide="zap" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Paper Balance</p>
                                            <p class="text-lg font-bold text-gray-900 dark:text-gray-100">
                                                <span x-text="analyticsData?.overview.paper1Progress + '%'"></span>
                                                <span class="text-sm text-gray-500 mx-1">vs</span>
                                                <span x-text="analyticsData?.overview.paper2Progress + '%'"></span>
                                            </p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Paper 1 vs Paper 2</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Charts Section -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Confidence Distribution</h3>
                                    <div class="h-64">
                                        <canvas id="confidenceChart"></canvas>
                                    </div>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Progress by Subject</h3>
                                    <div class="h-64">
                                        <canvas id="subjectChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Paper Readiness Charts -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Paper 1 Readiness</h3>
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.paper1Progress + '%'"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Progress</p>
                                        </div>
                                        <div>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.paper1AvgConfidence + '/5'"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Avg Confidence</p>
                                        </div>
                                    </div>
                                    <div class="h-48">
                                        <canvas id="paper1Chart"></canvas>
                                    </div>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Paper 2 Readiness</h3>
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.paper2Progress + '%'"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Progress</p>
                                        </div>
                                        <div>
                                            <p class="text-2xl font-bold text-gray-900 dark:text-gray-100" x-text="analyticsData?.overview.paper2AvgConfidence + '/5'"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Avg Confidence</p>
                                        </div>
                                    </div>
                                    <div class="h-48">
                                        <canvas id="paper2Chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <!-- Priority Insights and Topic Cards -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <!-- Critical Attention Needed -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-semibold text-red-600 dark:text-red-400">Critical Attention Needed</h3>
                                        <div class="flex items-center space-x-2" x-show="analyticsData?.insights.criticalTopics.length > 5">
                                            <button @click="prevCriticalPage()" :disabled="criticalTopicsPage === 0" class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded disabled:opacity-50">
                                                <i data-lucide="chevron-left" class="w-3 h-3"></i>
                                            </button>
                                            <span class="text-xs text-gray-500 dark:text-gray-400" x-text="`${criticalTopicsPage + 1}/${Math.ceil((analyticsData?.insights.criticalTopics.length || 0) / 5)}`"></span>
                                            <button @click="nextCriticalPage()" :disabled="criticalTopicsPage >= Math.ceil((analyticsData?.insights.criticalTopics.length || 0) / 5) - 1" class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded disabled:opacity-50">
                                                <i data-lucide="chevron-right" class="w-3 h-3"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <template x-for="topic in criticalTopicsPageCached" :key="topic.id">
                                            <div @click="goToTopicRevision(topic.id)" class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg cursor-pointer hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex-1">
                                                        <div class="font-medium text-gray-800 dark:text-gray-200 text-sm" x-text="topic.id + ' ' + topic.title"></div>
                                                        <div class="text-xs text-gray-600 dark:text-gray-400" x-text="topic.sectionTitle"></div>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <div class="flex items-center justify-center w-6 h-6 rounded text-xs font-bold text-white" :style="getConfidenceBarStyle(topic.confidence)" x-text="topic.confidence"></div>
                                                        <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        <div x-show="!analyticsData?.insights.criticalTopics.length" class="text-center py-4 text-gray-500 dark:text-gray-400">
                                            <i data-lucide="check-circle" class="w-8 h-8 mx-auto mb-2"></i>
                                            <p class="text-sm">No critical topics! Great job!</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Strong Areas -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-semibold text-green-600 dark:text-green-400">Strong Areas</h3>
                                        <div class="flex items-center space-x-2" x-show="analyticsData?.insights.strongTopics.length > 5">
                                            <button @click="prevStrongPage()" :disabled="strongTopicsPage === 0" class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded disabled:opacity-50">
                                                <i data-lucide="chevron-left" class="w-3 h-3"></i>
                                            </button>
                                            <span class="text-xs text-gray-500 dark:text-gray-400" x-text="`${strongTopicsPage + 1}/${Math.ceil((analyticsData?.insights.strongTopics.length || 0) / 5)}`"></span>
                                            <button @click="nextStrongPage()" :disabled="strongTopicsPage >= Math.ceil((analyticsData?.insights.strongTopics.length || 0) / 5) - 1" class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded disabled:opacity-50">
                                                <i data-lucide="chevron-right" class="w-3 h-3"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <template x-for="topic in strongTopicsPageCached" :key="topic.id">
                                            <div @click="goToTopicRevision(topic.id)" class="p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg cursor-pointer hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex-1">
                                                        <div class="font-medium text-gray-800 dark:text-gray-200 text-sm" x-text="topic.id + ' ' + topic.title"></div>
                                                        <div class="text-xs text-gray-600 dark:text-gray-400" x-text="topic.sectionTitle"></div>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <div class="flex items-center justify-center w-6 h-6 rounded text-xs font-bold text-white" :style="getConfidenceBarStyle(topic.confidence)" x-text="topic.confidence"></div>
                                                        <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        <div x-show="!analyticsData?.insights.strongTopics.length" class="text-center py-4 text-gray-500 dark:text-gray-400">
                                            <i data-lucide="target" class="w-8 h-8 mx-auto mb-2"></i>
                                            <p class="text-sm">No strong topics yet. Keep studying!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Study Velocity & Learning Patterns -->
                            <div x-show="analyticsData?.advanced" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                                <!-- Study Velocity Card -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center mb-4">
                                        <div class="p-2 bg-indigo-100 dark:bg-indigo-900 rounded-lg">
                                            <i data-lucide="trending-up" class="w-6 h-6 text-indigo-600 dark:text-indigo-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Study Velocity</h3>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Last 30 days</p>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Improvements:</span>
                                            <span class="font-semibold text-green-600 dark:text-green-400" x-text="analyticsData?.advanced?.studyVelocity.improvementsLast30Days || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Declines:</span>
                                            <span class="font-semibold text-red-600 dark:text-red-400" x-text="analyticsData?.advanced?.studyVelocity.declinesLast30Days || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Net Change:</span>
                                            <span class="font-semibold" :class="(analyticsData?.advanced?.studyVelocity.netImprovement || 0) >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'" x-text="(analyticsData?.advanced?.studyVelocity.netImprovement > 0 ? '+' : '') + (analyticsData?.advanced?.studyVelocity.netImprovement || 0)"></span>
                                        </div>
                                        <div class="pt-2 border-t border-gray-200 dark:border-gray-600">
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600 dark:text-gray-400">Success Rate:</span>
                                                <span class="font-semibold text-blue-600 dark:text-blue-400" x-text="(analyticsData?.advanced?.studyVelocity.improvementRate || 0) + '%'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Study Patterns Card -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center mb-4">
                                        <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
                                            <i data-lucide="calendar" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Study Patterns</h3>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Your habits</p>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Study Sessions:</span>
                                            <span class="font-semibold text-gray-800 dark:text-gray-200" x-text="analyticsData?.advanced?.studyPatterns.totalSessions || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Topics/Session:</span>
                                            <span class="font-semibold text-gray-800 dark:text-gray-200" x-text="analyticsData?.advanced?.studyPatterns.avgTopicsPerSession || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Study Days:</span>
                                            <span class="font-semibold text-gray-800 dark:text-gray-200" x-text="analyticsData?.advanced?.studyPatterns.studyDaysThisMonth || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Most Active:</span>
                                            <span class="font-semibold text-gray-800 dark:text-gray-200" x-text="analyticsData?.advanced?.studyPatterns.mostActiveDay || 'No data'"></span>
                                        </div>
                                        <div class="pt-2 border-t border-gray-200 dark:border-gray-600">
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600 dark:text-gray-400">Current Streak:</span>
                                                <span class="font-semibold text-orange-600 dark:text-orange-400" x-text="(analyticsData?.advanced?.studyPatterns.currentStreak || 0) + ' days'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Mastery Progress Card -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center mb-4">
                                        <div class="p-2 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
                                            <i data-lucide="award" class="w-6 h-6 text-yellow-600 dark:text-yellow-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Mastery Levels</h3>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Topic distribution</p>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Not Started:</span>
                                            <span class="font-semibold text-gray-500 dark:text-gray-400" x-text="analyticsData?.advanced?.masteryProgress.notStarted || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Beginning:</span>
                                            <span class="font-semibold text-red-600 dark:text-red-400" x-text="analyticsData?.advanced?.masteryProgress.beginning || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Developing:</span>
                                            <span class="font-semibold text-orange-600 dark:text-orange-400" x-text="analyticsData?.advanced?.masteryProgress.developing || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Competent:</span>
                                            <span class="font-semibold text-yellow-600 dark:text-yellow-400" x-text="analyticsData?.advanced?.masteryProgress.competent || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Proficient:</span>
                                            <span class="font-semibold text-blue-600 dark:text-blue-400" x-text="analyticsData?.advanced?.masteryProgress.proficient || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Mastered:</span>
                                            <span class="font-semibold text-green-600 dark:text-green-400" x-text="analyticsData?.advanced?.masteryProgress.mastered || 0"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity Timeline -->
                            <div x-show="analyticsData?.advanced" class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Recent Study Activity</h3>
                                <div class="space-y-3 max-h-64 overflow-y-auto">
                                    <template x-for="(change, index) in (analyticsHistoryData || []).slice(0, 10)" :key="change.timestamp || change.topicId + '-' + index">
                                        <div class="flex items-center space-x-3 p-2 rounded-lg" :class="change.newLevel > change.oldLevel ? 'bg-green-50 dark:bg-green-900/20' : change.newLevel < change.oldLevel ? 'bg-red-50 dark:bg-red-900/20' : 'bg-gray-50 dark:bg-gray-700/20'">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-6 h-6 rounded flex items-center justify-center text-xs font-bold text-white" :style="getConfidenceBarStyle(change.oldLevel)" x-text="change.oldLevel || '-'"></div>
                                                <i :data-lucide="change.newLevel > change.oldLevel ? 'arrow-up' : change.newLevel < change.oldLevel ? 'arrow-down' : 'minus'" class="w-4 h-4" :class="change.newLevel > change.oldLevel ? 'text-green-600' : change.newLevel < change.oldLevel ? 'text-red-600' : 'text-gray-400'"></i>
                                                <div class="w-6 h-6 rounded flex items-center justify-center text-xs font-bold text-white" :style="getConfidenceBarStyle(change.newLevel)" x-text="change.newLevel || '-'"></div>
                                            </div>
                                            <div class="flex-1">
                                                <div class="text-sm font-medium text-gray-800 dark:text-gray-200" x-text="change.topicId"></div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400" x-text="change.date + ' at ' + change.time"></div>
                                            </div>
                                        </div>
                                    </template>
                                    <div x-show="!analyticsHistoryData?.length" class="text-center py-4 text-gray-500 dark:text-gray-400">
                                        <i data-lucide="clock" class="w-8 h-8 mx-auto mb-2"></i>
                                        <p class="text-sm">No study activity recorded yet. Start rating topics to see your progress!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
